[tox]
envlist = py39,py310,py311,py312,py313,integration-sqlalchemy,integration-gino
isolated_build = true

# Base dependencies shared across environments
[base]
deps =
    pytest>=7.4
    pytest-cov>=4.1
    simple-ddl-parser>=1.0.0
    Jinja2>=3.0.1
    py-models-parser>=1.0.0
    table-meta>=0.1.5

# Main test environment - runs unit and functional tests (no integration)
[testenv]
usedevelop = true
deps =
    {[base]deps}
    pydantic>=1.8.2,<2.0.0
    sqlalchemy>=2.0
commands =
    pytest tests/unit tests/functional -vv --cov=omymodels --cov-report=term-missing {posargs}

# Integration tests for SQLAlchemy-based generators (sqlalchemy, sqlalchemy_v2, sqlalchemy_core)
[testenv:integration-sqlalchemy]
basepython = python3.11
usedevelop = true
deps =
    {[base]deps}
    pydantic>=1.8.2,<2.0.0
    sqlalchemy>=2.0
commands =
    pytest tests/integration/sqlalchemy tests/integration/sqlalchemy_v2 tests/integration/sqlalchemy_core tests/integration/dataclass tests/integration/pydantic tests/integration/pydantic_v2 tests/integration/openapi3 -vv {posargs}

# Integration tests for Gino (requires SQLAlchemy<1.4)
[testenv:integration-gino]
basepython = python3.11
usedevelop = true
deps =
    {[base]deps}
    pydantic>=1.8.2,<2.0.0
    gino>=1.0.0
commands =
    pytest tests/integration/gino -vv {posargs}

# Integration tests for SQLModel - DISABLED
# SQLModel requires pydantic>=2.0, but table-meta (used by omymodels) requires pydantic<2.0
# This is an unresolvable conflict until table-meta adds pydantic 2.x support
# [testenv:integration-sqlmodel]
# basepython = python3.11
# ...

[testenv:coverage]
basepython = python3.11
usedevelop = true
deps =
    {[base]deps}
    pydantic>=1.8.2,<2.0.0
    sqlalchemy>=2.0
commands =
    pytest tests/unit tests/functional -vv --cov=omymodels --cov-report=term-missing --cov-report=html --cov-report=xml

[testenv:lint]
deps =
    flake8
commands =
    flake8 omymodels/
